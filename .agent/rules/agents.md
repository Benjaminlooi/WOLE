---
trigger: always_on
---

# Repository Guidelines

## Project Structure & Module Organization
- Root app: `App.js` (UI + relay logic), bootstrap: `index.js`.
- Native glue: `native/WolServerModule.js`.
- Android project: `android/` (generated by Expo prebuild; do not hand‑edit).
- Static assets: `assets/` (icons, splash, etc.).
- Web UI (Vite + React): `web/` with `src/` and `vite.config.js`.
- Expo config: `app.json`; transient state in `.expo/`.

## Build, Test, and Development Commands
- Install: `npm install` (root). For web UI: `cd web && npm install`.
- Prebuild (required for native modules): `npx expo prebuild -p android`.
- Run on Android: `npm run android` (builds and launches on device/emulator).
- Dev server (Metro): `npm run start`.
- Web UI: `cd web && npm run dev` (or `build` / `preview`).
- Re-run prebuild after changing Android permissions or native config.

## Coding Style & Naming Conventions
- JavaScript, 2‑space indent, single quotes, semicolons.
- Naming: camelCase for variables/functions; PascalCase for React components; UPPER_SNAKE_CASE for constants.
- File names: components `PascalCase.jsx/js`, utilities `camelCase.js`.
- Keep imports ordered: react/expo → third‑party → local.
- Match existing patterns in `App.js`; avoid adding unused deps.

## Testing Guidelines
- No test harness is configured yet. Recommended:
  - Mobile: Jest + React Native Testing Library.
  - Web: Jest + @testing-library/react with Vite.
- Place tests beside source as `*.test.js` (e.g., `native/wolUtils.test.js`).
- Aim for meaningful coverage of parsing, WOL packet building, and request handling.

## Commit & Pull Request Guidelines
- Use Conventional Commits where possible:
  - `feat(web): serve Vite UI from assets`
  - `fix(android): request POST_NOTIFICATIONS on Tiramisu`
- PRs should include: clear description, rationale, test plan (commands, devices), and screenshots for UI changes.
- Link related issues; keep PRs focused and incremental.
- Do not commit build artifacts or `.expo` state.

## Security & Configuration Tips
- Never commit secrets. The WOL relay expects a shared token in requests; use Tailscale ACLs to restrict access.
- After modifying Android permissions/FGS types, `npx expo prebuild -p android` then `npm run android`.
- Avoid manual edits in `android/`; prefer Expo config and prebuild.
